
# TestFinanceApp

## Описание

TestFinanceApp — это REST API для выполнения финансовых операций с пользователями, таких как пополнение баланса, переводы между пользователями и получение последних транзакций. Это приложение использует Go, Gin, PostgreSQL, Docker и Goose для миграций.

Основные возможности:
- **Пополнение баланса пользователя**
- **Перевод денег от одного пользователя к другому**
- **Просмотр 10 последних транзакций пользователя**

## Технологии

- **Go** — язык программирования для реализации бизнес-логики.
- **Gin** — фреймворк для создания REST API.
- **PostgreSQL** — база данных для хранения информации о пользователях и транзакциях.
- **Docker** — для контейнеризации приложения и базы данных.
- **Goose** — для миграций базы данных.
- **pgx** — драйвер PostgreSQL для Go.

## Требования

- Docker
- Docker Compose
- Go 1.18 и выше

## Установка и запуск

1. Создание файла конфигурации .env
Создайте файл .env в корне проекта

например:

```bash
DATABASE_URL=postgres://postgres:password@host_db:5432/name_db?sslmode=disable
PORT=8080
```

2. Запуск приложения через Docker Compose
Для того чтобы запустить приложение, используйте Docker Compose. В корне проекта выполните команду:

```bash
make run
```

Эта команда:

Поднимет контейнеры для базы данных и приложения.
Выполнит миграции для базы данных.
Запустит сервер на порту 8080.

3. Проверка работы приложения
После запуска контейнеров приложение будет доступно по адресу: http://localhost:8080.

Пример запросов через curl
Пополнение баланса пользователя:

```bash
curl -X POST http://localhost:8080/deposit -H "Content-Type: application/json" -d '{"user_id": 1, "amount": 200.0}'
```

В этом запросе пополняется баланс пользователя с ID 1 на 200.0.

Перевод денег от одного пользователя к другому:

```bash
curl -X POST http://localhost:8080/transfer -H "Content-Type: application/json" -d '{"from_user_id": 1, "to_user_id": 2, "amount": 50.0}'
```

Этот запрос переводит 50.0 от пользователя с ID 1 к пользователю с ID 2.

Просмотр последних 10 транзакций пользователя:

```bash
curl http://localhost:8080/transactions/1
```

Этот запрос возвращает последние 10 транзакций для пользователя с ID 1.

4. Остановка приложения
Для остановки приложения и удаления контейнеров выполните команду:

```bash
make down
```
5. Миграции
Миграции базы данных выполняются автоматически при запуске приложения через Docker Compose. Однако, если вам нужно вручную выполнить миграции, используйте следующую команду:

```bash
make migrate
```
Это выполнит миграции с помощью Goose.

## Структура API
1. Пополнение баланса пользователя      
Метод: POST         
URL: /deposit       
Тело запроса:       
```json
{
  "user_id": 1,
  "amount": 200.0
}
```
2. Перевод денег между пользователями       
Метод: POST         
URL: /transfer      
Тело запроса:       
```json
{
  "from_user_id": 1,
  "to_user_id": 2,
  "amount": 50.0
}
```
3. Просмотр 10 последних транзакций пользователя
Метод: GET      

URL: /transactions/{user_id}    

Пример запроса: 

```bash
curl http://localhost:8080/transactions/1
```

Возвращает последние 10 транзакций для пользователя с ID 1.

## Запуск тестов
Для запуска тестов сервисного слоя приложения используйте команду:

```bash
make test
```

## Структура базы данных

- Таблица users:

    - id: уникальный идентификатор пользователя (PRIMARY KEY)       
    - name: имя пользователя        
    - email: электронная почта пользователя (UNIQUE)        
    - balance: баланс пользователя (по умолчанию 0.0)       
    - created_at: дата создания пользователя        

- Таблица transactions:

    - id: уникальный идентификатор транзакции (PRIMARY KEY)
    - user_id: идентификатор пользователя, связанный с транзакцией (FOREIGN KEY на таблицу users)
    - amount: сумма транзакции
    - type: тип транзакции (например, deposit, transfer_in, transfer_out)
    - created_at: дата и время создания транзакции